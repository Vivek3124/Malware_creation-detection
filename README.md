# Virus_creation-detection

Below is the working directory for creation and detection and virus directory for virus to execute and propagate to other files and infect.
![image](https://user-images.githubusercontent.com/40607433/186499850-f99ff04f-0255-40b9-a35a-e67a5f659aa9.png)

- Main is the virus.py file which will be executed to propagate the virus infection in its directory and sub-directories.

- testfiles are to test virus propagation some are .py files while some are raw text files.

- virus body.txt
  - This file will have virus body code.

- encrypt_body.py
  - It will encrypt virus body.txt
  - Encrypted body of virus and key that is used to encrypt virus body.txt, will be written in main virus.py program.

- virus_body(infect and other functions).py
  - It is the annoted version of virus body.txt

- virus_detection.py
  - It is detection mechanism which uses idea of modifications in file size or file_modification time, and compare that with periodic stored details of files in virus dicectory.
  - file_details.txt will be created by virus_detection.py.
  
## First we look at the encryption of virus body code that is to be written in main virus.py file along with unique key used to encrypt it.

![image](https://user-images.githubusercontent.com/40607433/186501677-8ae26348-57fa-4e53-a205-d6640f42fedd.png)

![image](https://user-images.githubusercontent.com/40607433/186501792-6d0df59c-a3f1-48a2-9010-d8650f52d822.png)

## Now below is main virus.py code
- we can see as described in virus body code, key used in encryption of virus_body will be written just below the start of Decryption routine signature
  - In this code, we start by opening the current file in execution, i.e virus itself, decryption routine runs first by creating two empty strings encoded_vCode = '' and key = ''
  - Idea is to copy the encrypted virus_body code which is below the decryption routine (in line 43 below) and also extract the key written just below start of Decryption routine signature (line 9)
  - Then by using key we decrypt the encoded_vCode and execute the decrypted virus code using exec() function, which is visible in line 37 below.
  
  ![image](https://user-images.githubusercontent.com/40607433/186502486-54a9942f-9987-479e-9026-56bd49a137c3.png)
  
  - Now if I execute the virus.py program as shown in below image it will infect all the testfiles shown above which exists in its directories or subdirectories.
  - And virus.py will be copied with same decryption routine but with different form of encrypted virus body along with random key generated to encrypt it.

### Structure maintained while copying is as follows:

- Original program code
- Start of decryption routine
- Key
- Body of decryption routine
- End of decryption routine
- Encrypted virus body

## virus_detection.py program is basically executed based on command line arguments passed to it.
- if argv[1] == "True": then file_details will be written for then status of files
- else if argv[2] == "True": then scanning for file modification will be done.

### This approach of detection is good because even if virus modifies the decryption routine then also it will catch the detection because either due to file size changes or modification time changes(which will definitely change), as executable files are generally not modified this method works fine and gives less False positives(reporting virus when file is modified by user/programmer).
